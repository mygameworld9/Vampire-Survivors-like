# 🌟 Sparkle Survivors 闪闪幸存者

<p align="center">
  <a href="./README.md">English</a> | <strong>中文</strong>
</p>

> 一款基于 React + TypeScript + Vite 构建的高性能吸血鬼幸存者类游戏。

---

## ✨ 游戏特色

### 核心玩法
- 🎮 **肉鸽生存** – 在俯视角动作 Roguelike 中对抗无尽怪物潮
- ⚔️ **27+ 武器** – 从加特林到魔法飞弹，每种武器都有独特机制
- 🔮 **16 种技能** – 主动与被动技能，打造专属 Build
- 🧙 **6 位英雄** – 每位角色拥有独特的初始武器与属性
- 🗺️ **2 张地图** – 闹鬼森林与诅咒地窖，刷怪逻辑各异

### 进阶系统
- 💥 **元素反应** – 链式元素效果造成额外伤害（超载、热胀冷缩）
- 🏗️ **进化系统** – 将武器升级至终极形态（18 条进化路线）
- 💎 **元进程** – 跨局永久升级（军械库商店）
- 🎁 **宝藏系统** – 宝箱、探索点、宝藏哥布林

### 技术亮点
- ⚡ **高性能** – 对象池 + 空间哈希网格，300+ 敌人仍保持 60 FPS
- 🌍 **国际化** – 完整的中英双语支持
- 🎵 **复古合成音效** – 基于 Web Audio API 程序化生成
- 📱 **移动端支持** – 虚拟摇杆触屏控制

---

## 🚀 快速开始

### 环境要求
- Node.js 18+
- pnpm（推荐）或 npm

### 安装步骤

```bash
# 克隆仓库
git clone https://github.com/your-repo/sparkle-survivors.git
cd sparkle-survivors

# 安装依赖
pnpm install

# 启动开发服务器
pnpm run dev
```

游戏将运行在 `http://localhost:5173`

### 其他命令

```bash
# 运行测试
pnpm run test

# 生产构建
pnpm run build

# 预览生产版本
pnpm run preview
```

---

## 🏗️ 架构总览

Sparkle Survivors 采用 **Data-Logic-View (DLV)** 三层架构：

```
┌─────────────────────────────────────────────────────┐
│                  🎨 视图层 (View)                   │
│           React 组件 + HTML5 Canvas                 │
├─────────────────────────────────────────────────────┤
│                  ⚙️ 逻辑层 (Logic)                  │
│  Game.ts │ EntityManager │ CollisionSystem │ Spawn  │
├─────────────────────────────────────────────────────┤
│                  📊 数据层 (Data)                   │
│    weaponData │ enemyData │ skillData │ config     │
└─────────────────────────────────────────────────────┘
```

### 核心设计模式

| 模式 | 作用 | 位置 |
|:-----|:-----|:-----|
| **对象池** | 减少 GC 卡顿 | `EntityManager.ts` |
| **空间哈希网格** | O(1) 碰撞检测 | `CollisionSystem.ts` |
| **事件发射器** | 逻辑/UI 解耦 | `Game.ts → events` |
| **数据驱动** | "改配置不改代码" | `src/data/` |

---

## 📁 项目结构

```
src/
├── index.tsx              # 应用入口
├── GameComponent.tsx      # Canvas 包装器 + 游戏循环
│
├── components/            # React UI 组件 (21个)
├── core/                  # 游戏引擎核心 (12个)
│   ├── Game.ts            # 主游戏循环
│   ├── EntityManager.ts   # 实体生命周期
│   └── systems/           # 碰撞、刷怪、地图
├── entities/              # 游戏实体 (20+个)
├── data/                  # 静态数据配置 (15+个)
├── utils/                 # 工具类 (Vector2D, ObjectPool)
└── styles/                # CSS 样式表
```

详细代码映射请查看 [FILE_MAP.md](./FILE_MAP.md)。

---

## 📖 技术文档

详细的工程文档位于 [`docs/reverse-engineering/`](./docs/reverse-engineering/)：

| # | 文档 | 描述 |
|---|------|------|
| 00 | 架构总览 | DLV 架构、设计模式 |
| 01 | 游戏主循环 | update/draw 周期 |
| 02 | 实体管理 | 对象池、生命周期 |
| 03 | 碰撞系统 | 空间哈希、伤害计算 |
| 04 | 刷怪系统 | 怪物波次、事件时间轴 |
| 05 | 武器规格 | 全武器参数 |
| 06 | 技能规格 | 全技能参数 |
| 07 | 敌人设计 | 怪物类型与刷怪表 |
| 08 | 进化矩阵 | 武器进化路线 |

### 架构图表

可视化 Mermaid 图表位于 [`docs/diagrams/`](./docs/diagrams/)：

| # | 图表 | 描述 |
|---|------|------|
| 01 | 系统架构 | DLV 三层架构全景图 |
| 02 | 数据流 | 游戏主循环数据流与事件通信 |
| 03 | 实体关系 | 实体类继承与组合关系 |
| 04 | 武器进化 | 18 条武器进化路线可视化 |
| 05 | 状态机 | UI/玩家/敌人状态流转 |
| 06 | 模块依赖 | src/ 目录模块依赖映射 |

## 🎮 游戏内容

### 角色

| 角色 | 初始武器 | 特殊特性 |
|:-----|:---------|:---------|
| 闪光骑士 | 子弹 | 平衡型 |
| 影忍者 | 武士刀 | 高速度 |
| 奥术法师 | 魔法飞弹 | 强投射物 |
| 太阳祭司 | 阳炎 | 治疗能力 |
| 树叶游侠 | 冰刺 | 百发百中 |
| 月影术士 | 灵魂珠 | 暗影虚空魔法 |

### 怪物类型

| 怪物 | 血量 | 速度 | 特点 |
|:-----|:----:|:----:|:-----|
| 史莱姆 | 低 | 慢 | 基础敌人 |
| 蜘蛛 | 低 | 快 | 集群行为 |
| 蝙蝠 | 低 | 极快 | 难以命中 |
| 蘑菇 | 高 | 慢 | 肉盾 |
| 幽灵 | 中 | 中 | 穿越障碍 |
| 石魔 | 极高 | 慢 | 精英伤害 |
| 骷髅 | 中 | 中 | 不死追踪 |
| 宝藏哥布林 | 低 | 快 | 掉金币，会逃跑！ |

---

## 🛠️ 开发

### 技术栈
- **前端**: React 18, TypeScript 5, Vite 5
- **测试**: Vitest + 覆盖率报告
- **渲染**: HTML5 Canvas 2D
- **音频**: Web Audio API（程序化合成）
- **存储**: localStorage 存档

### 运行测试

```bash
# 监听模式运行所有测试
pnpm run test

# 单次运行并生成覆盖率
pnpm run test:coverage
```

---

## 🚢 部署

项目已配置 Vercel 部署：

```bash
# 构建并部署
vercel --prod
```

配置详情见 `vercel.json`。

---

## 📄 许可证

MIT 许可证 - 详见 [LICENSE](./LICENSE)。

---

<p align="center">
  以 ⚡ 和 ❤️ 打造
</p>
